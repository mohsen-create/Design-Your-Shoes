<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Realistic Shoe Designer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  body {
    font-family: 'Montserrat', sans-serif;
    background: #f7f7f7;
    margin: 0; padding: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  h1 {
    margin-bottom: 25px;
    color: #222;
  }
  #designer {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
    width: 720px;
    max-width: 95vw;
    background: white;
    padding: 25px 30px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  }
  #shoe-container {
    position: relative;
    width: 480px;
    height: 320px;
    background: #e0e0e0;
    border-radius: 20px;
    box-shadow: inset 0 0 15px #bbb;
    overflow: visible;
  }
  #shoe-base, #shoe-sole, #shoe-laces, #pattern-overlay, #logo {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: contain;
    pointer-events: none;
    transition: filter 0.3s ease;
  }
  #logo {
    pointer-events: auto;
    cursor: grab;
    width: 130px;
    height: 70px;
    top: 130px;
    left: 320px;
    z-index: 10;
  }
  #controls {
    flex: 1;
    max-width: 200px;
    display: flex;
    flex-direction: column;
    gap: 18px;
  }
  label {
    font-weight: 700;
    margin-bottom: 5px;
    color: #333;
  }
  select, input[type="color"], input[type="file"] {
    width: 100%;
    padding: 8px 10px;
    font-size: 15px;
    border-radius: 7px;
    border: 1.8px solid #ccc;
    outline-offset: 1px;
    transition: border-color 0.3s ease;
  }
  select:hover, input[type="color"]:hover, input[type="file"]:hover {
    border-color: #0073e6;
  }
  button {
    padding: 12px;
    font-size: 16px;
    font-weight: 700;
    border-radius: 8px;
    border: none;
    background-color: #0073e6;
    color: white;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0, 115, 230, 0.4);
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #005bb5;
  }
  .pattern-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .pattern-toggle input {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>Realistic Shoe Designer</h1>

<div id="designer">
  <div id="shoe-container" title="Drag the logo to reposition">
    <img id="shoe-base" src="" alt="Shoe base" />
    <img id="shoe-sole" src="" alt="Sole" />
    <img id="shoe-laces" src="" alt="Laces" />
    <img id="pattern-overlay" src="" alt="Pattern overlay" style="display:none; mix-blend-mode: multiply; opacity: 0.7;" />
    <img id="logo" alt="Logo" style="display:none;" />
  </div>

  <div id="controls">
    <label for="shoeType">Shoe Type</label>
    <select id="shoeType">
      <option value="sneaker">Sneaker</option>
      <option value="cleats">Cleats</option>
      <option value="athletic">Athletic</option>
    </select>

    <label for="colorUpper">Upper Color</label>
    <input type="color" id="colorUpper" value="#ffffff" />

    <label for="colorSole">Sole Color</label>
    <input type="color" id="colorSole" value="#333333" />

    <label for="colorLaces">Laces Color</label>
    <input type="color" id="colorLaces" value="#ffffff" />

    <label>Pattern Overlay</label>
    <div class="pattern-toggle">
      <input type="checkbox" id="patternCamo" />
      <label for="patternCamo" style="font-weight: 400;">Camouflage</label>
    </div>
    <div class="pattern-toggle">
      <input type="checkbox" id="patternLeather" />
      <label for="patternLeather" style="font-weight: 400;">Leather Grain</label>
    </div>
    <div class="pattern-toggle">
      <input type="checkbox" id="patternCarbon" />
      <label for="patternCarbon" style="font-weight: 400;">Carbon Fiber</label>
    </div>

    <label for="logoUpload">Upload Logo (PNG with transparent background)</label>
    <input type="file" id="logoUpload" accept="image/png" />

    <button id="downloadBtn">Download Design</button>
  </div>
</div>

<script>
  // Reliable images for each shoe part by type
  const shoeImages = {
    sneaker: {
      base: 'https://i.imgur.com/MN4vEzX.png',       // white sneaker base
      sole: 'https://i.imgur.com/VxVfGtv.png',       // black sole
      laces: 'https://i.imgur.com/j7hGQzT.png'       // white laces
    },
    cleats: {
      base: 'https://i.imgur.com/GX7qN7B.png',       // cleats base
      sole: 'https://i.imgur.com/L5vtLfq.png',       // cleats sole
      laces: 'https://i.imgur.com/EVLfDEz.png'       // cleats laces
    },
    athletic: {
      base: 'https://i.imgur.com/Kv3OnG1.png',       // athletic shoe base
      sole: 'https://i.imgur.com/MQHXfUl.png',       // athletic sole
      laces: 'https://i.imgur.com/24Q9jqX.png'       // athletic laces
    }
  };

  // Pattern overlays (semi-transparent textures)
  const patterns = {
    camo: 'https://i.imgur.com/ly5rhYY.png',
    leather: 'https://i.imgur.com/LntDmDc.png',
    carbon: 'https://i.imgur.com/KnB2vJz.png'
  };

  const shoeBase = document.getElementById('shoe-base');
  const shoeSole = document.getElementById('shoe-sole');
  const shoeLaces = document.getElementById('shoe-laces');
  const patternOverlay = document.getElementById('pattern-overlay');
  const logo = document.getElementById('logo');

  const shoeType = document.getElementById('shoeType');
  const colorUpper = document.getElementById('colorUpper');
  const colorSole = document.getElementById('colorSole');
  const colorLaces = document.getElementById('colorLaces');

  const patternCamo = document.getElementById('patternCamo');
  const patternLeather = document.getElementById('patternLeather');
  const patternCarbon = document.getElementById('patternCarbon');

  const logoUpload = document.getElementById('logoUpload');
  const downloadBtn = document.getElementById('downloadBtn');
  const shoeContainer = document.getElementById('shoe-container');

  // Set shoe images for selected type
  function setShoeImages() {
    const type = shoeType.value;
    shoeBase.src = shoeImages[type].base;
    shoeSole.src = shoeImages[type].sole;
    shoeLaces.src = shoeImages[type].laces;
    updateColors();
    updatePatternOverlay();
  }

  // Convert hex color to RGB
  function hexToRgb(hex) {
    let bigint = parseInt(hex.slice(1), 16);
    let r = (bigint >> 16) & 255;
    let g = (bigint >> 8) & 255;
    let b = bigint & 255;
    return [r, g, b];
  }

  // Apply color by CSS filters (simple tint effect)
  function applyColor(imgElement, hexColor) {
    // Using CSS filter approximation for tint
    const [r,g,b] = hexToRgb(hexColor);
    // Use drop-shadow trick for tint effect
    imgElement.style.filter = `drop-shadow(0 0 0 rgb(${r},${g},${b}))`;
    imgElement.style.mixBlendMode = 'multiply';
    imgElement.style.backgroundColor = hexColor;
  }

  function updateColors() {
    applyColor(shoeBase, colorUpper.value);
    applyColor(shoeSole, colorSole.value);
    applyColor(shoeLaces, colorLaces.value);
  }

  // Pattern overlay logic: only one pattern at a time, priority Camo > Leather > Carbon
  function updatePatternOverlay() {
    if (patternCamo.checked) {
      patternOverlay.src = patterns.camo;
      patternOverlay.style.display = 'block';
    } else if (patternLeather.checked) {
      patternOverlay.src = patterns.leather;
      patternOverlay.style.display = 'block';
    } else if (patternCarbon.checked) {
      patternOverlay.src = patterns.carbon;
      patternOverlay.style.display = 'block';
    } else {
      patternOverlay.src = '';
      patternOverlay.style.display = 'none';
    }
  }

  // Logo upload and show
  logoUpload.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      logo.src = ev.target.result;
      logo.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  // Drag logo logic
  let dragging = false;
  let dragOffsetX, dragOffsetY;

  logo.addEventListener('mousedown', (e) => {
    dragging = true;
    const rect = logo.getBoundingClientRect();
    dragOffsetX = e.clientX - rect.left;
    dragOffsetY = e.clientY - rect.top;
    logo.style.cursor = 'grabbing';
  });

  window.addEventListener('mouseup', () => {
    dragging = false;
    logo.style.cursor = 'grab';
  });

  window.addEventListener('mousemove', (e) => {
    if (!dragging) return;
    const containerRect = shoeContainer.getBoundingClientRect();

    let newLeft = e.clientX - containerRect.left - dragOffsetX;
    let newTop = e.clientY - containerRect.top - dragOffsetY;

    // Clamp to container bounds
    const maxLeft = shoeContainer.clientWidth - logo.clientWidth;
    const maxTop = shoeContainer.clientHeight - logo.clientHeight;
    if (newLeft < 0) newLeft = 0;
    if (newTop < 0) newTop = 0;
    if (newLeft > maxLeft) newLeft = maxLeft;
    if (newTop > maxTop) newTop = maxTop;

    logo.style.left = newLeft + 'px';
    logo.style.top = newTop + 'px';
  });

  // Control event listeners
  shoeType.addEventListener('change', setShoeImages);
  colorUpper.addEventListener('input', updateColors);
  colorSole.addEventListener('input', updateColors);
  colorLaces.addEventListener('input', updateColors);

  patternCamo.addEventListener('change', () => {
    if (patternCamo.checked) {
      patternLeather.checked = false;
      patternCarbon.checked = false;
    }
    updatePatternOverlay();
  });
  patternLeather.addEventListener('change', () => {
    if (patternLeather.checked) {
      patternCamo.checked = false;
      patternCarbon.checked = false;
    }
    updatePatternOverlay();
  });
  patternCarbon.addEventListener('change', () => {
    if (patternCarbon.checked) {
      patternCamo.checked = false;
      patternLeather.checked = false;
    }
    updatePatternOverlay();
  });

  // Download the shoe design as PNG
  downloadBtn.addEventListener('click', () => {
    const canvas = document.createElement('canvas');
    canvas.width = shoeContainer.clientWidth;
    canvas.height = shoeContainer.clientHeight;
    const ctx = canvas.getContext('2d');

    function drawImageFromEl(img) {
      if (!img.src || img.style.display === 'none') return;
      const style = window.getComputedStyle(img);
      let left = parseFloat(img.style.left) || 0;
      let top = parseFloat(img.style.top) || 0;
      ctx.filter = style.filter || 'none';
      ctx.globalAlpha = parseFloat(style.opacity) || 1;
      ctx.drawImage(img, left, top, img.clientWidth, img.clientHeight);
      ctx.filter = 'none';
      ctx.globalAlpha = 1;
    }

    // Draw order matters
    drawImageFromEl(shoeBase);
    drawImageFromEl(shoeSole);
    drawImageFromEl(shoeLaces);
    drawImageFromEl(patternOverlay);
    drawImageFromEl(logo);

    // Save canvas as PNG
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.download = 'shoe-design.png';
      link.href = url;
      link.click();
      URL.revokeObjectURL(url);
    });
  });

  // Init
  setShoeImages();
</script>

</body>
</html>
